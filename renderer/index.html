<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Test Toolkit Studio</title>
    <link rel="stylesheet" href="styles/common.css" />
    <link rel="stylesheet" href="styles/platform.css" />
    <link rel="stylesheet" href="styles/main.css" />
    <link rel="stylesheet" href="styles/pages/project.css" />
    <link rel="stylesheet" href="styles/pages/testcase.css" />
    <link rel="stylesheet" href="styles/pages/device.css" />
    <link rel="stylesheet" href="styles/pages/log.css" />
    <link rel="stylesheet" href="styles/pages/report.css" />
    <link rel="stylesheet" href="styles/pages/settings.css" />
  </head>
  <body>
    <script>
      // Set platform class for CSS
      document.body.classList.add("platform-" + process.platform);
    </script>

    <!-- Title bar area for dragging -->
    <div class="titlebar-area">
      <!-- 自定义标题栏 - 仅在Windows上显示 -->
      <div class="custom-titlebar platform-win32-only">
        <div class="titlebar-drag-region">
          <div class="titlebar-title">Test Toolkit Studio</div>
        </div>
        <div class="titlebar-controls">
          <button
            class="titlebar-btn minimize-btn"
            id="minimize-btn"
            title="最小化"
          >
            <svg width="10" height="10" viewBox="0 0 10 10">
              <path d="M0,5 L10,5" stroke="currentColor" stroke-width="1" />
            </svg>
          </button>
          <button
            class="titlebar-btn maximize-btn"
            id="maximize-btn"
            title="最大化"
          >
            <svg width="10" height="10" viewBox="0 0 10 10">
              <path
                d="M0,0 L10,0 L10,10 L0,10 Z"
                stroke="currentColor"
                stroke-width="1"
                fill="none"
              />
            </svg>
          </button>
          <button class="titlebar-btn close-btn" id="close-btn" title="关闭">
            <svg width="10" height="10" viewBox="0 0 10 10">
              <path
                d="M0,0 L10,10 M10,0 L0,10"
                stroke="currentColor"
                stroke-width="1"
              />
            </svg>
          </button>
        </div>
      </div>
    </div>

    <div class="app-container">
      <!-- Main App Content -->
      <div class="app-main">
        <!-- Sidebar Navigation -->
        <nav class="sidebar">
          <div class="sidebar-header">
            <img
              src="../assets/logo/toolkit_no_focus_logo.png"
              alt="TT"
              class="logo-small"
            />
            <img
              src="../assets/logo/toolkit_logo.png"
              alt="Test Toolkit Studio"
              class="logo-large"
            />
          </div>

          <div class="nav-items">
            <div class="nav-item active" data-page="project">
              <svg class="nav-icon" viewBox="0 0 24 24">
                <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z" />
              </svg>
              <span class="nav-label">Project</span>
            </div>

            <div class="nav-item" data-page="testcase">
              <svg class="nav-icon" viewBox="0 0 24 24">
                <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z" />
              </svg>
              <span class="nav-label">Testcase</span>
            </div>

            <div class="nav-item" data-page="device">
              <svg class="nav-icon" viewBox="0 0 24 24">
                <path
                  d="M17 1.01L7 1c-1.1 0-2 .9-2 2v18c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2V3c0-1.1-.9-1.99-2-1.99zM17 19H7V5h10v14z"
                />
              </svg>
              <span class="nav-label">Device</span>
            </div>

            <div class="nav-item" data-page="log">
              <svg class="nav-icon" viewBox="0 0 24 24">
                <path
                  d="M19 3h-4.18C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm2 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"
                />
              </svg>
              <span class="nav-label">Log Viewer</span>
            </div>

            <div class="nav-item" data-page="report">
              <svg class="nav-icon" viewBox="0 0 24 24">
                <path
                  d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"
                />
              </svg>
              <span class="nav-label">Insights</span>
            </div>

            <div class="nav-item" data-page="settings">
              <svg class="nav-icon" viewBox="0 0 24 24">
                <path
                  d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.36,4.8,11.69,4.8,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z"
                />
              </svg>
              <span class="nav-label">Settings</span>
            </div>
          </div>

          <div class="sidebar-footer">
            <div class="user-info" id="userInfo">
              <div class="user-avatar">U</div>
              <span class="user-name">User</span>
            </div>
          </div>
        </nav>

        <!-- Main Content Area -->
        <main class="main-content">
          <!-- Project Page -->
          <div class="page active" id="projectPage">
            <div class="page-header">
              <h2>Project Management</h2>
              <div class="header-actions">
                <button class="btn btn-primary" id="createProjectBtn">
                  <svg class="btn-icon" viewBox="0 0 24 24">
                    <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" />
                  </svg>
                  New Project
                </button>
                <button class="btn btn-secondary" id="openProjectBtn">
                  <svg class="btn-icon" viewBox="0 0 24 24">
                    <path
                      d="M10 4H4c-1.11 0-2 .89-2 2v12c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2h-8l-2-2z"
                    />
                  </svg>
                  Open Project
                </button>
              </div>
            </div>

            <div class="project-content">
              <div class="project-info" id="projectInfo" style="display: none">
                <div class="info-card">
                  <div
                    style="
                      display: flex;
                      justify-content: space-between;
                      align-items: center;
                      margin-bottom: 16px;
                    "
                  >
                    <h3>Current Project</h3>
                    <button class="btn btn-secondary" id="backToProjectsBtn">
                      <svg
                        class="btn-icon"
                        viewBox="0 0 24 24"
                        style="margin-right: 4px"
                      >
                        <path
                          d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"
                        />
                      </svg>
                      Back to Projects
                    </button>
                  </div>
                  <p class="project-path" id="projectPath"></p>

                  <div class="project-actions">
                    <div class="action-card">
                      <h4>Import Test Cases</h4>
                      <p>Import test cases from CSV file</p>
                      <button class="btn btn-outline" id="importCsvBtn">
                        <svg class="btn-icon" viewBox="0 0 24 24">
                          <path
                            d="M14 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6zm-1 9v4h-2v-4H8l4-4 4 4h-3z"
                          />
                        </svg>
                        Import CSV
                      </button>
                    </div>

                    <div class="action-card">
                      <h4>Test Cases</h4>
                      <p>View and manage test cases</p>
                      <div class="testcase-list" id="testcaseList"></div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Loading State -->
              <div class="project-loading" id="projectLoading">
                <div class="loading-content">
                  <div class="loading-spinner"></div>
                  <h3>Loading...</h3>
                </div>
              </div>

              <div
                class="project-welcome"
                id="welcomeScreen"
                style="display: none"
              >
                <div id="welcomeContent">
                  <img
                    src="../assets/logo/toolkit_welcome.png"
                    alt="Test Toolkit Studio"
                    class="welcome-logo"
                  />
                  <h3>Welcome to Test Toolkit Studio</h3>
                  <p>
                    Create a new project or open an existing one to get started
                  </p>
                </div>

                <div
                  class="recent-projects"
                  id="recentProjects"
                  style="display: none"
                >
                  <h4>Recent Projects</h4>
                  <div class="project-list" id="projectList"></div>
                </div>
              </div>
            </div>
          </div>

          <!-- Testcase Page -->
          <div class="page" id="testcasePage">
            <div class="testcase-header">
              <div class="project-path-bar">
                <h2>Testcase</h2>
              </div>
              <div class="device-selector">
                <select id="deviceSelect">
                  <option value="">Select Device</option>
                </select>
                <button class="btn btn-icon" id="refreshDeviceBtn">
                  <svg viewBox="0 0 24 24">
                    <path
                      d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"
                    />
                  </svg>
                </button>
              </div>
            </div>

            <div class="testcase-container">
              <!-- File Explorer -->
              <div class="file-explorer" id="fileExplorer">
                <div class="explorer-header">
                  <h3>Case Explorer</h3>
                </div>
                <div class="file-tree" id="fileTree"></div>
                <!-- Explorer Resizer -->
                <div class="explorer-resizer" id="explorerResizer"></div>
              </div>

              <!-- Code Editor -->
              <div class="editor-container">
                <div class="editor-tabs" id="editorTabs">
                  <!-- 动态生成tab -->
                </div>
                <div id="editorWorkspace" class="editor-workspace">
                  <!-- 编辑器标签将在这里动态生成 -->
                </div>

                <!-- Bottom Panel (UI Elements + Console) -->
                <div
                  class="ui-elements-bottom-panel"
                  id="uiElementsBottomPanel"
                >
                  <!-- Bottom Panel Resizer -->
                  <div
                    class="bottom-panel-resizer"
                    id="bottomPanelResizer"
                  ></div>
                  <div class="elements-tabs">
                    <div class="tab-header">
                      <button class="tab-btn active" data-tab="elements-list">
                        UI元素
                      </button>
                      <button
                        class="tab-btn"
                        data-tab="element-props"
                        id="elementPropsTab"
                      >
                        元素属性
                      </button>
                      <button
                        class="tab-btn"
                        data-tab="locator-lib"
                        id="locatorLibTab"
                      >
                        Locator库
                      </button>
                      <button
                        class="tab-btn"
                        data-tab="console-output"
                        id="consoleTab"
                      >
                        控制台
                      </button>
                      <div class="tab-actions">
                        <button
                          class="btn btn-icon btn-small"
                          id="toggleElementsPanelBtn"
                          title="收起"
                        >
                          <svg viewBox="0 0 24 24" id="toggleElementsPanelIcon">
                            <path
                              d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"
                            />
                          </svg>
                        </button>
                        <button
                          class="btn btn-icon btn-small"
                          id="clearConsoleBtn"
                          title="清空控制台"
                          style="display: none"
                        >
                          <svg viewBox="0 0 24 24">
                            <path
                              d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"
                            />
                          </svg>
                        </button>
                      </div>
                    </div>
                    <div class="tab-content" id="uiElementsPanelContent">
                      <!-- Elements List Tab -->
                      <div class="tab-pane active" id="elementsListPane">
                        <div
                          class="elements-list-container"
                          id="elementsListContainer"
                        >
                          <div class="empty-state">
                            <div class="empty-state-text">暂无UI元素</div>
                          </div>
                        </div>
                      </div>
                      <!-- Element Properties Tab -->
                      <div
                        class="tab-pane"
                        id="elementPropsPane"
                        style="display: none"
                      >
                        <div
                          class="element-props-container"
                          id="elementPropsContainer"
                        >
                          <div class="empty-state">
                            <div class="empty-state-text">未选择元素</div>
                          </div>
                        </div>
                      </div>
                      <!-- Locator Library Tab -->
                      <div
                        class="tab-pane"
                        id="locatorLibPane"
                        style="display: none"
                      >
                        <div
                          class="locator-lib-container"
                          id="locatorLibContainer"
                        >
                          <div class="locator-search-bar">
                            <input
                              type="text"
                              id="locatorSearchInput"
                              placeholder="搜索元素名称..."
                            />
                          </div>
                          <div class="locator-list" id="locatorList">
                            <div class="empty-state">
                              <div class="empty-state-text">暂无保存的元素</div>
                              <div class="empty-state-hint">
                                在元素属性页面点击"入库"保存元素
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                      <!-- Console Output Tab -->
                      <div
                        class="tab-pane"
                        id="consoleOutputPane"
                        style="display: none"
                      >
                        <div class="console-output" id="consoleOutput"></div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Vertical Resizer -->
              <div class="vertical-resizer" id="verticalResizer"></div>

              <!-- Right Panel -->
              <div class="right-panel" id="rightPanel">
                <!-- Run Button -->
                <div class="run-section">
                  <button class="btn btn-primary btn-block" id="runTestBtn">
                    <svg class="btn-icon" viewBox="0 0 24 24">
                      <path d="M8 5v14l11-7z" />
                    </svg>
                    Run Test
                  </button>
                </div>

                <!-- Device Screen -->
                <div class="device-screen">
                  <div class="screen-header">
                    <h4>Device Screen</h4>
                    <div class="mode-slider-container">
                      <div class="mode-slider" id="modeSlider">
                        <div class="slider-track">
                          <div
                            class="slider-indicator"
                            id="sliderIndicator"
                          ></div>
                        </div>
                        <div class="mode-options">
                          <div
                            class="mode-option active"
                            data-mode="normal"
                            title="纯屏幕模式"
                          >
                            <svg class="mode-icon" viewBox="0 0 24 24">
                              <path
                                d="M17 1H7c-1.1 0-2 .9-2 2v18c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2V3c0-1.1-.9-2-2-2zM7 4V3h10v1H7zm0 14V6h10v12H7z"
                              />
                            </svg>
                          </div>
                          <div
                            class="mode-option"
                            data-mode="xml"
                            title="XML Overlay模式"
                          >
                            <svg class="mode-icon" viewBox="0 0 24 24">
                              <path
                                d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27C12.59 15.41 11.11 16 9.5 16A6.5 6.5 0 0 1 3 9.5A6.5 6.5 0 0 1 9.5 3m0 2C7.01 5 5 7.01 5 9.5S7.01 14 9.5 14 14 11.99 14 9.5 11.99 5 9.5 5Z"
                              />
                            </svg>
                          </div>
                          <div
                            class="mode-option"
                            data-mode="crop"
                            title="裁切模式"
                          >
                            <svg class="mode-icon" viewBox="0 0 24 24">
                              <path
                                d="M7 17V1H5v4H1v2h4v10c0 1.1.9 2 2 2h10v4h2v-4h4v-2H7zM7 15V7h8v8H7z"
                              />
                            </svg>
                          </div>
                          <div
                            class="mode-option"
                            data-mode="coordinate"
                            title="坐标模式"
                          >
                            <svg class="mode-icon" viewBox="0 0 24 24">
                              <path
                                d="M12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm8.94 3c-.46-4.17-3.77-7.48-7.94-7.94V1h-2v2.06C6.83 3.52 3.52 6.83 3.06 11H1v2h2.06c.46 4.17 3.77 7.48 7.94 7.94V23h2v-2.06c4.17-.46 7.48-3.77 7.94-7.94H23v-2h-2.06zM12 19c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z"
                              />
                            </svg>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="screen-content" id="screenContent">
                    <img
                      id="deviceScreenshot"
                      src=""
                      alt="Device screen"
                      style="display: none"
                    />
                    <div class="screen-placeholder">No device connected</div>
                    <!-- 截图模式的选择框 -->
                    <div
                      id="screenshotSelector"
                      class="screenshot-selector"
                      style="display: none"
                    >
                      <div class="selector-box"></div>
                      <div class="selector-controls">
                        <button
                          class="btn btn-primary btn-small"
                          id="confirmScreenshotBtn"
                        >
                          确定
                        </button>
                        <button
                          class="btn btn-secondary btn-small"
                          id="cancelScreenshotBtn"
                        >
                          取消
                        </button>
                      </div>
                    </div>
                    <!-- 坐标模式的点击标记 -->
                    <div
                      id="coordinateMarker"
                      class="coordinate-marker"
                      style="display: none"
                    >
                      <div class="coordinate-dot"></div>
                      <div class="coordinate-label"></div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Device Page -->
          <div class="page" id="devicePage">
            <div class="page-header">
              <h2>Device Management</h2>
              <div class="header-actions">
                <button class="jb-btn jb-btn-primary" id="connectDeviceBtn">
                  <svg class="jb-btn-icon" viewBox="0 0 24 24">
                    <path
                      d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"
                    />
                  </svg>
                  Connect Device
                </button>
                <button class="jb-btn jb-btn-secondary" id="addDeviceBtn">
                  <svg class="jb-btn-icon" viewBox="0 0 24 24">
                    <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" />
                  </svg>
                  Add Config
                </button>
                <button class="jb-btn jb-btn-default" id="scanDevicesBtn">
                  <svg class="jb-btn-icon" viewBox="0 0 24 24">
                    <path
                      d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"
                    />
                  </svg>
                  Refresh
                </button>
              </div>
            </div>

            <div class="device-content">
              <!-- 添加设备表单 -->
              <div class="device-form" id="deviceForm" style="display: none">
                <h3>Add New Device</h3>
                <form id="newDeviceForm">
                  <div class="form-row">
                    <div class="form-group">
                      <label>Device Name</label>
                      <input
                        type="text"
                        name="deviceName"
                        placeholder="e.g., iPhone 15 Pro"
                        required
                      />
                    </div>
                    <div class="form-group">
                      <label>Platform Version</label>
                      <input
                        type="text"
                        name="platformVersion"
                        placeholder="e.g., 15"
                        required
                      />
                    </div>
                  </div>

                  <div class="form-row">
                    <div class="form-group">
                      <label>Platform</label>
                      <div class="radio-group" id="platformRadios">
                        <label class="radio-option">
                          <input type="radio" name="platform" value="android" checked>
                          <span class="radio-label">Android</span>
                        </label>
                        <label class="radio-option">
                          <input type="radio" name="platform" value="ios">
                          <span class="radio-label">iOS</span>
                        </label>
                      </div>
                    </div>
                    <div class="form-group">
                      <label>Connection Type</label>
                      <div class="radio-group" id="connectionRadios">
                        <label class="radio-option">
                          <input type="radio" name="connectionType" value="usb" checked>
                          <span class="radio-label">USB</span>
                        </label>
                        <label class="radio-option">
                          <input type="radio" name="connectionType" value="wifi">
                          <span class="radio-label">WiFi</span>
                        </label>
                      </div>
                    </div>
                  </div>

                  <!-- 1. Android + USB 配置 -->
                  <div class="config-group" id="android-usb-config" style="display: none;">
                    <div class="form-row">
                      <div class="form-group">
                        <label>Device ID (Optional)</label>
                        <input
                          type="text"
                          name="deviceId"
                          placeholder="e.g., RF8M90XXXXX or leave empty to auto-detect"
                        />
                        <small class="form-help">Android device serial number, auto-detect if empty</small>
                      </div>
                    </div>
                  </div>

                  <!-- 2. Android + WiFi 配置 -->
                  <div class="config-group" id="android-wifi-config" style="display: none;">
                    <div class="form-row">
                      <div class="form-group">
                        <label>Device IP Address</label>
                        <input
                          type="text"
                          name="ipAddress"
                          placeholder="e.g., 192.168.1.100"
                          pattern="^(\d{1,3}\.){3}\d{1,3}$"
                          required
                        />
                      </div>
                      <div class="form-group">
                        <label>ADB Port</label>
                        <input
                          type="number"
                          name="port"
                          placeholder="5555"
                          min="1"
                          max="65535"
                        />
                        <small class="form-help">ADB over network port</small>
                      </div>
                    </div>
                  </div>

                  <!-- 3. iOS + USB 配置 -->
                  <div class="config-group" id="ios-usb-config" style="display: none;">
                    <div class="form-row">
                      <div class="form-group">
                        <label>Device UDID</label>
                        <input
                          type="text"
                          name="udid"
                          placeholder="e.g., 00008110-000A2D8E3A82802E"
                          required
                        />
                        <small class="form-help">iOS device unique identifier</small>
                      </div>
                      <div class="form-group">
                        <label>Test App Bundle ID</label>
                        <input
                          type="text"
                          name="bundleId"
                          placeholder="e.g., com.example.app"
                        />
                        <small class="form-help">Default app for testing</small>
                      </div>
                    </div>
                  </div>

                  <!-- 4. iOS + WiFi 配置 -->
                  <div class="config-group" id="ios-wifi-config" style="display: none;">
                    <div class="form-row">
                      <div class="form-group">
                        <label>Device UDID</label>
                        <input
                          type="text"
                          name="udid"
                          placeholder="e.g., 00008110-000A2D8E3A82802E"
                          required
                        />
                        <small class="form-help">iOS device unique identifier</small>
                      </div>
                      <div class="form-group">
                        <label>Test App Bundle ID</label>
                        <input
                          type="text"
                          name="bundleId"
                          placeholder="e.g., com.example.app"
                        />
                        <small class="form-help">Default app for testing</small>
                      </div>
                    </div>
                    <div class="form-row">
                      <div class="form-group">
                        <label>WDA Service IP</label>
                        <input
                          type="text"
                          name="wdaIpAddress"
                          placeholder="e.g., 192.168.1.100"
                          pattern="^(\d{1,3}\.){3}\d{1,3}$"
                          required
                        />
                        <small class="form-help">iOS device WiFi IP address</small>
                      </div>
                      <div class="form-group">
                        <label>WDA Port</label>
                        <input
                          type="number"
                          name="wdaPort"
                          placeholder="8100"
                          min="1"
                          max="65535"
                        />
                        <small class="form-help">WebDriverAgent service port</small>
                      </div>
                    </div>
                  </div>


                  <!-- 高级设置 (可折叠) -->
                  <div class="advanced-settings">
                    <div
                      class="advanced-toggle"
                      onclick="toggleAdvancedSettings()"
                    >
                      <svg
                        viewBox="0 0 24 24"
                        width="16"
                        height="16"
                        class="toggle-icon"
                      >
                        <path
                          fill="currentColor"
                          d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"
                        />
                      </svg>
                      <span>Advanced Settings (Optional)</span>
                    </div>
                    <div
                      class="advanced-content"
                      id="advancedSettingsContent"
                      style="display: none"
                    >
                      <div class="form-row">
                        <div class="form-group">
                          <label>Automation Name</label>
                          <input
                            type="text"
                            name="automationName"
                            value="UiAutomator2"
                          />
                        </div>
                        <div class="form-group">
                          <label>Command Timeout</label>
                          <input
                            type="number"
                            name="newCommandTimeout"
                            value="6000"
                          />
                        </div>
                      </div>
                      <div class="form-row">
                        <div class="form-group">
                          <label>No Reset</label>
                          <select name="noReset">
                            <option value="true">True</option>
                            <option value="false">False</option>
                          </select>
                        </div>
                        <div class="form-group">
                          <!-- Empty for layout balance -->
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="form-actions">
                    <button type="submit" class="btn btn-primary">
                      Save Device
                    </button>
                    <button
                      type="button"
                      class="btn btn-secondary"
                      id="cancelDeviceBtn"
                    >
                      Cancel
                    </button>
                  </div>
                </form>
              </div>

              <!-- 连接设备引导弹窗 - 动态加载 -->
              <div id="connectionGuideModalContainer"></div>

              <!-- 设备管理区域 -->
              <div class="device-sections">
                <!-- 保存的设备 -->
                <div class="device-section">
                  <h3>Saved Devices</h3>
                  <div class="device-grid" id="savedDevicesGrid">
                    <!-- 动态生成的设备卡片，包括有线和无线设备 -->
                  </div>
                </div>

                <!-- 当前连接的设备 -->
                <div class="device-section">
                  <h3>Connected Devices</h3>
                  <div class="device-grid" id="connectedDevicesGrid">
                    <!-- 动态生成的连接设备信息，包括有线和无线设备 -->
                  </div>
                </div>
              </div>
            </div>
            
            <!-- APK模态框容器 -->
            <div id="apkModalsContainer"></div>
          </div>

          <!-- Test Report Page -->
          <div class="page" id="reportPage">
            <div class="page-header">
              <h2>Insights</h2>
              <div class="header-actions">
                <select id="reportProjectSelect" class="control-select">
                  <option value="all">All projects</option>
                  <option value="current">Current project</option>
                </select>
                <select id="reportSeverityFilter" class="control-select">
                  <option value="all">All severities</option>
                  <option value="critical">Critical</option>
                  <option value="high">High</option>
                  <option value="moderate">Moderate</option>
                  <option value="low">Low</option>
                  <option value="info">Info</option>
                </select>
                <button class="btn btn-secondary" id="moreFiltersBtn">
                  More filters
                </button>
                <span style="margin: 0 8px; color: var(--text-secondary)"
                  >|</span
                >
                <select id="reportTimeRange" class="control-select">
                  <option value="7">Last 7 days</option>
                  <option value="30" selected>Last 30 days</option>
                  <option value="90">Last 90 days</option>
                  <option value="180">Last 6 months</option>
                  <option value="365">Last year</option>
                </select>
              </div>
            </div>

            <div class="report-content">
              <!-- Top Stats Row -->
              <div class="report-stats-row">
                <div class="stat-box">
                  <h4>Projects</h4>
                  <div class="stat-value">1</div>
                </div>
                <div class="stat-box">
                  <h4>Bug</h4>
                  <div class="stat-value">11</div>
                </div>
                <div class="stat-box coverage">
                  <h4>Avg. coverage rate</h4>
                  <div class="stat-value">80.33%</div>
                </div>
              </div>

              <!-- Main Grid -->
              <div class="report-main-grid">
                <!-- Left Column - Problems by severity -->
                <div class="severity-card">
                  <div class="card-header">
                    <h3>Problems by severity</h3>
                  </div>
                  <div class="donut-chart-wrapper">
                    <div class="donut-chart-container">
                      <canvas id="severityChart"></canvas>
                      <div class="chart-center-text">
                        <div class="chart-center-value">3 K</div>
                        <div class="chart-center-label">problems</div>
                      </div>
                    </div>
                  </div>
                  <div class="severity-legend">
                    <div class="legend-item">
                      <span
                        class="legend-dot"
                        style="background: #e55765"
                      ></span>
                      <span class="legend-label">Critical:</span>
                      <span class="legend-value">1897</span>
                    </div>
                    <div class="legend-item">
                      <span
                        class="legend-dot"
                        style="background: #f09f5b"
                      ></span>
                      <span class="legend-label">High:</span>
                      <span class="legend-value">1613</span>
                    </div>
                    <div class="legend-item">
                      <span
                        class="legend-dot"
                        style="background: #f4c752"
                      ></span>
                      <span class="legend-label">Moderate:</span>
                      <span class="legend-value">439</span>
                    </div>
                  </div>
                </div>

                <!-- Right Column - Problems over period -->
                <div class="timeline-card">
                  <div class="card-header">
                    <h3>Problems over period</h3>
                  </div>
                  <div class="timeline-chart-container">
                    <canvas id="timelineChart"></canvas>
                  </div>
                  <div class="timeline-legend">
                    <!-- 图例将由JavaScript动态生成 -->
                  </div>
                </div>
              </div>

              <!-- Tables Grid -->
              <div class="report-tables-grid">
                <!-- Projects sorted by problems -->
                <div class="table-card">
                  <h3>Projects sorted by number of problems ↓</h3>
                  <table class="compact-table">
                    <thead>
                      <tr>
                        <th>Project</th>
                        <th>Problems</th>
                        <th>Critical severity</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td>Nest JS</td>
                        <td class="problem-count">1753</td>
                        <td class="problem-count">156</td>
                      </tr>
                      <tr>
                        <td>axios</td>
                        <td class="problem-count">1715</td>
                        <td class="problem-count">1578</td>
                      </tr>
                      <tr>
                        <td>enzyme</td>
                        <td class="problem-count">393</td>
                        <td class="problem-count">162</td>
                      </tr>
                      <tr>
                        <td>playwright-java</td>
                        <td class="problem-count">62</td>
                        <td class="problem-count">0</td>
                      </tr>
                      <tr>
                        <td>spring-test</td>
                        <td class="problem-count">19</td>
                        <td class="problem-count">1</td>
                      </tr>
                      <tr>
                        <td>FlexInspect</td>
                        <td class="problem-count">6</td>
                        <td class="problem-count">0</td>
                      </tr>
                    </tbody>
                  </table>
                </div>

                <!-- Problems sorted by severity -->
                <div class="table-card">
                  <h3>Problems sorted by severity ↓</h3>
                  <table class="compact-table">
                    <thead>
                      <tr>
                        <th>Inspection</th>
                        <th>Severity</th>
                        <th>Occurrence</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td>ESLint</td>
                        <td>
                          <span class="severity-badge critical">Critical</span>
                        </td>
                        <td class="problem-count">1889</td>
                      </tr>
                      <tr>
                        <td>Attempt to assign to const or readonly variable</td>
                        <td>
                          <span class="severity-badge critical">Critical</span>
                        </td>
                        <td class="problem-count">5</td>
                      </tr>
                      <tr>
                        <td>Hardcoded passwords</td>
                        <td>
                          <span class="severity-badge critical">Critical</span>
                        </td>
                        <td class="problem-count">2</td>
                      </tr>
                      <tr>
                        <td>Invalid properties configuration</td>
                        <td>
                          <span class="severity-badge critical">Critical</span>
                        </td>
                        <td class="problem-count">1</td>
                      </tr>
                      <tr>
                        <td>Import can be shortened</td>
                        <td><span class="severity-badge high">High</span></td>
                        <td class="problem-count">583</td>
                      </tr>
                      <tr>
                        <td>Unused local symbol</td>
                        <td><span class="severity-badge high">High</span></td>
                        <td class="problem-count">502</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
            
            <!-- 筛选器弹窗 -->
            <div id="filterModal" class="filter-modal" style="display: none;">
              <div class="filter-modal-content">
                <div class="filter-modal-header">
                  <h3>Filter Options</h3>
                  <button class="close-btn" id="closeFilterBtn">&times;</button>
                </div>
                <div class="filter-modal-body">
                  <!-- 动态生成的筛选器内容 -->
                </div>
                <div class="filter-modal-footer">
                  <button class="btn btn-primary" id="applyFilterBtn">Apply</button>
                  <button class="btn btn-secondary" id="clearFilterBtn">Clear All</button>
                </div>
              </div>
            </div>
          </div>

          <!-- Log Page -->
          <div class="page" id="logPage">
            <div class="page-header">
              <h2>Log Viewer</h2>
              <div class="header-actions">
                <button class="btn btn-primary" id="toggleLogBtn">
                  <svg class="btn-icon" viewBox="0 0 24 24">
                    <path d="M8 5v14l11-7z" />
                  </svg>
                  Start
                </button>
                <button class="btn btn-secondary" id="clearLogBtn">
                  <svg class="btn-icon" viewBox="0 0 24 24">
                    <path
                      d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"
                    />
                  </svg>
                  Clear
                </button>
                <button class="btn btn-secondary" id="exportLogBtn">
                  <svg class="btn-icon" viewBox="0 0 24 24">
                    <path
                      d="M19 12v7H5v-7H3v7c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-7h-2zm-6 .67l2.59-2.58L17 11.5l-5 5-5-5 1.41-1.41L11 12.67V3h2z"
                    />
                  </svg>
                  Export
                </button>
                <button
                  class="btn btn-secondary active"
                  id="followLogBtn"
                  title="Auto-scroll to latest logs"
                >
                  <svg class="btn-icon" viewBox="0 0 24 24">
                    <path
                      d="M12 5.83L15.17 9l1.41-1.41L12 3 7.41 7.59 8.83 9 12 5.83zm0 12.34L8.83 15l-1.41 1.41L12 21l4.59-4.59L15.17 15 12 18.17z"
                    />
                  </svg>
                  Auto Scroll
                </button>
              </div>
            </div>

            <!-- ADB Logcat风格的控制区域 -->
            <div class="logcat-controls">
              <!-- 第一行：设备和基本控制 -->
              <div class="control-row">
                <div class="control-group">
                  <label>Device:</label>
                  <select id="logDeviceSelect" class="control-select">
                    <option value="">Select a device</option>
                  </select>
                </div>

                <div class="control-group">
                  <label>Format:</label>
                  <select id="logFormatSelect" class="control-select">
                    <option value="threadtime">threadtime</option>
                    <option value="time">time</option>
                    <option value="brief">brief</option>
                    <option value="long">long</option>
                    <option value="raw">raw</option>
                  </select>
                </div>

                <div class="control-group">
                  <label>Buffer:</label>
                  <select id="logBufferSelect" class="control-select">
                    <option value="main">main</option>
                    <option value="system">system</option>
                    <option value="radio">radio</option>
                    <option value="events">events</option>
                    <option value="all">all</option>
                  </select>
                </div>
              </div>

              <!-- 第二行：模式切换和过滤器 -->
              <div class="control-row">
                <div class="control-group">
                  <label>Filter Mode:</label>
                  <div class="filter-mode-toggle">
                    <label class="mode-option">
                      <input type="radio" name="filterMode" value="simple" id="simpleModeRadio" checked>
                      <span>Simple</span>
                    </label>
                    <label class="mode-option">
                      <input type="radio" name="filterMode" value="expert" id="expertModeRadio">
                      <span>Expert</span>
                    </label>
                  </div>
                </div>
              </div>

              <!-- Expert模式：Logcat Filter Spec -->
              <div class="control-row" id="expertFilterRow" style="display: none;">
                <div class="control-group filter-input-group" style="flex: 1">
                  <label>Filter Spec:</label>
                  <input
                    type="text"
                    id="logFilterSpec"
                    class="control-input"
                    placeholder="例如: flutter:V ActivityManager:I MyApp:D *:S"
                    title="Logcat filter specification: TAG:LEVEL format"
                    style="flex: 1"
                  />
                  <button id="applyFilterBtn" class="btn btn-secondary btn-sm">Apply</button>
                </div>
              </div>

              <!-- Simple模式：分离的过滤器 -->
              <div id="simpleFilterRows">
                <div class="control-row">
                  <div class="control-group">
                    <label>Log Level:</label>
                    <select id="simpleLogLevel" class="control-select">
                      <option value="V">Verbose (V)</option>
                      <option value="D">Debug (D)</option>
                      <option value="I" selected>Info (I)</option>
                      <option value="W">Warn (W)</option>
                      <option value="E">Error (E)</option>
                      <option value="A">Assert (A)</option>
                    </select>
                  </div>

                  <div class="control-group filter-input-group">
                    <label>Tag:</label>
                    <input
                      type="text"
                      id="simpleTagFilter"
                      class="control-input"
                      placeholder="flutter, ActivityManager, etc."
                    />
                  </div>

                  <div class="control-group filter-input-group">
                    <label>Package:</label>
                    <input
                      type="text"
                      id="simplePackageFilter"
                      class="control-input"
                      placeholder="com.example.app"
                    />
                  </div>
                </div>
              </div>

              <!-- 第三行：快速搜索 -->
              <div class="control-row">
                <div class="control-group filter-input-group">
                  <label>Search:</label>
                  <input
                    type="text"
                    id="logSearchInput"
                    class="control-input"
                    placeholder="Search in log content..."
                  />
                </div>

                <div class="control-group">
                  <label>
                    <input type="checkbox" id="regexSearchCheckbox"> Regex
                  </label>
                </div>

                <div class="control-group">
                  <label>
                    <input type="checkbox" id="caseSensitiveCheckbox"> Case Sensitive
                  </label>
                </div>
              </div>
            </div>

            <div class="log-viewer">
              <div class="log-container" id="logContainer">
                <!-- 日志条目将动态添加到这里 -->
              </div>
            </div>
          </div>

          <!-- Settings Page -->
          <div class="page" id="settingsPage">
            <div class="page-header">
              <h2>Settings</h2>
            </div>

            <div class="settings-content">
              <div class="settings-section">
                <h3>User Information</h3>
                <div class="user-details" id="userDetails">
                  <div class="detail-row">
                    <span class="detail-label">Username:</span>
                    <span class="detail-value" id="settingsUsername">-</span>
                  </div>
                  <div class="detail-row">
                    <span class="detail-label">Email:</span>
                    <span class="detail-value" id="settingsEmail">-</span>
                  </div>
                  <div class="detail-row">
                    <span class="detail-label">Member Group:</span>
                    <span class="detail-value" id="settingsMemberGroup">-</span>
                  </div>
                  <div class="detail-row">
                    <span class="detail-label">Member Since:</span>
                    <span class="detail-value" id="settingsMemberSince">-</span>
                  </div>
                </div>
              </div>

              <div class="settings-section">
                <h3>API Configuration</h3>
                <div class="form-group">
                  <label>Base URL</label>
                  <input
                    type="url"
                    id="settingsBaseUrl"
                    value="https://api.test-toolkit.app"
                  />
                  <button class="btn btn-secondary" id="updateBaseUrlBtn">
                    Update
                  </button>
                </div>
              </div>

              <div class="settings-section">
                <h3>编辑器设置</h3>
                <div class="form-group">
                  <label>字体设置</label>
                  <div style="display: flex; gap: 10px; align-items: center">
                    <select id="editorFontFamily" style="flex: 1">
                      <option value="var(--font-mono)">应用默认字体</option>
                      <option value="Consolas, 'Courier New', monospace">
                        Consolas
                      </option>
                      <option value="'SF Mono', Monaco, monospace">
                        'SF Mono'
                      </option>
                      <option value="'Cascadia Code', monospace">
                        'Cascadia Code'
                      </option>
                      <option value="'Fira Code', monospace">
                        'Fira Code'
                      </option>
                      <option value="'JetBrains Mono', monospace">
                        'JetBrains Mono'
                      </option>
                      <option value="Monaco, monospace">Monaco</option>
                      <option value="'Courier New', monospace">
                        'Courier New'
                      </option>
                    </select>
                    <input
                      type="number"
                      id="editorFontSize"
                      min="10"
                      max="24"
                      value="14"
                      style="width: 60px"
                    />
                    <span>px</span>
                  </div>
                  <button class="btn btn-secondary" id="applyFontSettings">
                    应用字体设置
                  </button>
                </div>
              </div>

              <div class="settings-section">
                <h3>Android SDK</h3>
                <div class="sdk-status">
                  <div class="status-item">
                    <span>SDK Status:</span>
                    <span class="status-indicator" id="sdkStatus"
                      >Checking...</span
                    >
                  </div>
                  <div class="status-item">
                    <span>ADB Status:</span>
                    <span class="status-indicator" id="adbStatus"
                      >Checking...</span
                    >
                  </div>
                  <button class="btn btn-secondary" id="checkSdkBtn">
                    Check SDK
                  </button>
                </div>
              </div>

              <div class="settings-section">
                <h3>About</h3>
                <div class="about-info">
                  <p><strong>Toolkit Studio</strong></p>
                  <p id="about-version">Version: loading...</p>
                </div>
              </div>

              <div class="settings-section">
                <button class="btn btn-danger" id="logoutBtn">
                  <svg class="btn-icon" viewBox="0 0 24 24">
                    <path
                      d="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z"
                    />
                  </svg>
                  Logout
                </button>
              </div>
            </div>
          </div>
        </main>
      </div>

      <!-- Status Bar -->
      <div class="status-bar">
        <div class="status-left">
          <div class="status-item" id="currentProjectStatus">
            <svg class="status-icon" viewBox="0 0 24 24">
              <path
                d="M10 4H4c-1.11 0-2 .89-2 2v12c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2h-8l-2-2z"
              />
            </svg>
            <span id="statusBarProjectPath">No project opened</span>
          </div>
        </div>
        <div class="status-right">
          <!-- 编辑器模式文字 -->
          <span id="editorModeText" class="editor-mode-text"></span>
        </div>
      </div>
    </div>

    <!-- 通用模态框 - 动态加载 -->
    <div id="commonModalsContainer"></div>

    <script>
      // Save Node require
      window.nodeRequire = require;
    </script>
    <script src="js/modules/image-matcher.js"></script>
    <script src="js/core/wda-controller.js"></script>
    <script src="js/ui/editor-tab.js"></script>
    <script src="js/ui/editor-manager.js"></script>
    <script src="js/ui/custom-titlebar.js"></script>
    <script src="js/utils/component-loader.js"></script>
    <script src="js/app.js"></script>
  </body>
</html>
